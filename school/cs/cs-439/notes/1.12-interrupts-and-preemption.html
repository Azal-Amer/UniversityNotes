<!DOCTYPE html> <html lang="en"><head>
<title>1.12 Interrupts and Preemption</title>
<base href="../../../..">
<meta name="pathname" content="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html">
<meta name="description" content="ObsidianVault - 1.12 Interrupts and Preemption">
<meta property="og:title" content="1.12 Interrupts and Preemption">
<meta property="og:description" content="ObsidianVault - 1.12 Interrupts and Preemption">
<meta property="og:type" content="website">
<meta property="og:url" content="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html">
<meta property="og:image" content="undefined">
<meta charset="UTF-8"><meta property="og:site_name" content="ObsidianVault"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-wasm-script" src="site-lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="site-lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="preload" href="site-lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/snippets.css"></noscript><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="stylesheet" href="site-lib/styles/theme.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/supported-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/supported-plugins.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><body class="publish css-settings-manager mod-macos is-frameless is-hidden-frameless show-inline-title show-ribbon ctp-latte ctp-mocha-old ctp-accent-maroon anp-speech-bubble anp-codeblock-numbers anp-list-toggle anp-table-toggle anp-table-width anp-table-auto anp-color-transition-toggle anp-button-metadata-toggle anp-header-color-toggle anp-header-margin-toggle anp-h1-red anp-h1-divider anp-h2-peach anp-h2-divider anp-h3-green anp-h4-teal anp-h5-lavender anp-h6-mauve anp-italic-teal anp-highlight-yellow anp-simple-rainbow-color-toggle anp-simple-rainbow-title-toggle anp-simple-rainbow-collapse-icon-toggle anp-simple-rainbow-indentation-toggle anp-simple-rainbow-icon-toggle anp-rainbow-subfolder-color-toggle anp-fixed-status-bar anp-alternate-tab-toggle anp-card-layout-filebrowser anp-theme-ext-dark ctp-nord-light ctp-flexoki-dark"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><div id="search-container"><div id="search-wrapper"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div aria-label="Clear search" id="search-clear-button"></div></div></div></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"><link itemprop="include" href="site-lib/html/file-tree-content.html"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties latex-referencer-en math-booster-en" data-type="markdown"><style id="MJX-CHTML-styles">mjx-c.mjx-c7D.TEX-S4::before{padding:1.75em .806em 1.249em 0;content:"}"}mjx-c.mjx-c7D.TEX-S3::before{padding:1.45em .75em .949em 0;content:"}"}mjx-c.mjx-c7D::before{padding:.75em .5em .25em 0;content:"}"}mjx-c.mjx-c222C.TEX-S1::before{padding:.805em .957em .306em 0;content:"∬"}mjx-c.mjx-c2227::before{padding:.598em .667em .022em 0;content:"∧"}mjx-c.mjx-c27E8.TEX-S4::before{padding:1.75em .806em 1.248em 0;content:"⟨"}mjx-c.mjx-c27E9.TEX-S4::before{padding:1.75em .806em 1.248em 0;content:"⟩"}mjx-c.mjx-c222D.TEX-S2::before{padding:1.36em 1.98em .862em 0;content:"∭"}mjx-c.mjx-c2119.TEX-A::before{padding:.683em .611em 0 0;content:"P"}mjx-c.mjx-c1D43E.TEX-I::before{padding:.683em .889em 0 0;content:"K"}mjx-c.mjx-c1D437.TEX-I::before{padding:.683em .828em 0 0;content:"D"}mjx-c.mjx-c221A.TEX-S4::before{padding:1.75em 1.02em 1.25em 0;content:"√"}mjx-c.mjx-c226B::before{padding:.567em 1em .067em 0;content:"≫"}mjx-c.mjx-c59::before{padding:.683em .75em 0 0;content:"Y"}mjx-c.mjx-c42::before{padding:.683em .708em 0 0;content:"B"}mjx-c.mjx-c2D9::before{padding:.669em .5em 0 0;content:"˙"}mjx-c.mjx-c2265::before{padding:.636em .778em .138em 0;content:"≥"}mjx-c.mjx-c22EF::before{padding:.31em 1.172em 0 0;content:"⋯"}mjx-c.mjx-c211D.TEX-A::before{padding:.683em .722em 0 0;content:"R"}mjx-c.mjx-c48::before{padding:.683em .75em 0 0;content:"H"}mjx-c.mjx-c79::before{padding:.431em .528em .204em 0;content:"y"}mjx-c.mjx-c21::before{padding:.716em .278em 0 0;content:"!"}mjx-c.mjx-c4E::before{padding:.683em .75em 0 0;content:"N"}mjx-c.mjx-c2243::before{padding:.464em .778em 0 0;content:"≃"}mjx-c.mjx-c46::before{padding:.68em .653em 0 0;content:"F"}mjx-c.mjx-c1D44C.TEX-I::before{padding:.683em .763em 0 0;content:"Y"}mjx-c.mjx-cB1::before{padding:.666em .778em 0 0;content:"±"}mjx-c.mjx-c2DA::before{padding:.715em .5em 0 0;content:"˚"}mjx-stretchy-v.mjx-c7B mjx-beg mjx-c::before{content:"⎧";padding:.899em .889em .01em 0}mjx-stretchy-v.mjx-c7B mjx-ext mjx-c::before{content:"⎪";width:.889em}mjx-stretchy-v.mjx-c7B mjx-end mjx-c::before{content:"⎩";padding:.01em .889em .899em 0}mjx-stretchy-v.mjx-c7B mjx-mid mjx-c::before{content:"⎨";padding:1.16em .889em .66em 0}mjx-stretchy-v.mjx-c7B>mjx-mid{margin-top:-.91em;margin-bottom:-.91em}mjx-stretchy-v.mjx-c7B>mjx-end{margin-top:-.909em}mjx-stretchy-v.mjx-c7B>mjx-ext{height:50%;border-top-width:.879em;border-bottom-width:.879em}mjx-c.mjx-c1D712.TEX-I::before{padding:.442em .626em .204em 0;content:"χ"}mjx-c.mjx-c27F9::before{padding:.525em 1.638em .024em 0;content:"⟹"}mjx-c.mjx-c2D::before{padding:.252em .333em 0 0;content:"-"}mjx-c.mjx-c3A0::before{padding:.68em .75em 0 0;content:"Π"}mjx-munderover{display:inline-block;text-align:left}mjx-munderover:not([limits=false]){padding-top:.1em}mjx-munderover:not([limits=false])>*{display:block}mjx-mpadded{display:inline-block;text-align:left}mjx-rbox{display:inline-block;position:relative}mjx-c.mjx-c2211.TEX-S2::before{padding:.95em 1.444em .45em 0;content:"∑"}mjx-c.mjx-c23::before{padding:.694em .833em .194em 0;content:"#"}mjx-c.mjx-c2264::before{padding:.636em .778em .138em 0;content:"≤"}mjx-c.mjx-c3A::before{padding:.43em .278em 0 0;content:":"}mjx-c.mjx-c1D540.TEX-A::before{padding:.683em .389em 0 0;content:"I"}mjx-c.mjx-c77::before{padding:.431em .722em .011em 0;content:"w"}mjx-c.mjx-c22EE::before{padding:1.3em .278em .03em 0;content:"⋮"}mjx-c.mjx-c1D443.TEX-I::before{padding:.683em .751em 0 0;content:"P"}mjx-c.mjx-c1D457.TEX-I::before{padding:.661em .412em .204em 0;content:"j"}mjx-c.mjx-c4B::before{padding:.683em .778em 0 0;content:"K"}mjx-c.mjx-c28.TEX-MI::before{padding:.75em .517em .25em 0;content:"("}mjx-c.mjx-c29.TEX-MI::before{padding:.75em .409em .25em 0;content:")"}mjx-c.mjx-c31.TEX-MI::before{padding:.666em .511em 0 0;content:"1"}mjx-c.mjx-c24::before{padding:.75em .5em .056em 0;content:"$"}mjx-c.mjx-c30.TEX-MI::before{padding:.665em .562em .021em 0;content:"0"}mjx-c.mjx-c22A4::before{padding:.668em .778em 0 0;content:"⊤"}mjx-c.mjx-c5B.TEX-S1::before{padding:.85em .417em .349em 0;content:"["}mjx-c.mjx-c5D.TEX-S1::before{padding:.85em .417em .349em 0;content:"]"}mjx-c.mjx-c2033::before{padding:.56em .55em 0 0;content:"′′"}mjx-c.mjx-c3B::before{padding:.43em .278em .194em 0;content:";"}mjx-c.mjx-c221E::before{padding:.442em 1em .011em 0;content:"∞"}mjx-c.mjx-c1D462.TEX-I::before{padding:.442em .572em .011em 0;content:"u"}mjx-c.mjx-c1D70F.TEX-I::before{padding:.431em .517em .013em 0;content:"τ"}mjx-stretchy-v.mjx-c5B mjx-beg mjx-c::before{content:"⎡";padding:1.154em .667em .645em 0}mjx-stretchy-v.mjx-c5B mjx-ext mjx-c::before{content:"⎢";width:.667em}mjx-stretchy-v.mjx-c5B mjx-end mjx-c::before{content:"⎣";padding:1.155em .667em .644em 0}mjx-stretchy-v.mjx-c5B>mjx-end{margin-top:-1.799em}mjx-stretchy-v.mjx-c5B>mjx-ext{border-top-width:1.769em;border-bottom-width:1.769em}mjx-stretchy-v.mjx-c5D mjx-beg mjx-c::before{content:"⎤";padding:1.154em .667em .645em 0}mjx-stretchy-v.mjx-c5D mjx-ext mjx-c::before{content:"⎥";width:.667em}mjx-stretchy-v.mjx-c5D mjx-end mjx-c::before{content:"⎦";padding:1.155em .667em .644em 0}mjx-stretchy-v.mjx-c5D>mjx-end{margin-top:-1.799em}mjx-stretchy-v.mjx-c5D>mjx-ext{border-top-width:1.769em;border-bottom-width:1.769em}mjx-c.mjx-c47::before{padding:.705em .785em .022em 0;content:"G"}mjx-c.mjx-c56::before{padding:.683em .75em .022em 0;content:"V"}mjx-c.mjx-c1D43A.TEX-I::before{padding:.705em .786em .022em 0;content:"G"}mjx-c.mjx-cD7::before{padding:.491em .778em 0 0;content:"×"}mjx-c.mjx-c1D43D.TEX-I::before{padding:.683em .633em .022em 0;content:"J"}mjx-c.mjx-c1D6FE.TEX-I::before{padding:.441em .543em .216em 0;content:"γ"}mjx-c.mjx-c7A::before{padding:.431em .444em 0 0;content:"z"}mjx-c.mjx-c54::before{padding:.677em .722em 0 0;content:"T"}mjx-c.mjx-c4D::before{padding:.683em .917em 0 0;content:"M"}mjx-c.mjx-c2032::before{padding:.56em .275em 0 0;content:"′"}mjx-c.mjx-c5E::before{padding:.694em .5em 0 0;content:"^"}mjx-c.mjx-c52::before{padding:.683em .736em .022em 0;content:"R"}mjx-c.mjx-c44::before{padding:.683em .764em 0 0;content:"D"}mjx-c.mjx-c2261::before{padding:.464em .778em 0 0;content:"≡"}mjx-c.mjx-c7B.TEX-S3::before{padding:1.45em .75em .949em 0;content:"{"}mjx-c.mjx-c4C::before{padding:.683em .625em 0 0;content:"L"}mjx-c.mjx-c7B.TEX-S4::before{padding:1.75em .806em 1.249em 0;content:"{"}mjx-c.mjx-c7B.TEX-S2::before{padding:1.15em .667em .649em 0;content:"{"}mjx-c.mjx-c7B.TEX-S1::before{padding:.85em .583em .349em 0;content:"{"}mjx-c.mjx-c1D44A.TEX-I::before{padding:.683em 1.048em .022em 0;content:"W"}mjx-c.mjx-c7B::before{padding:.75em .5em .25em 0;content:"{"}mjx-c.mjx-c1D464.TEX-I::before{padding:.443em .716em .011em 0;content:"w"}mjx-c.mjx-c2193::before{padding:.694em .5em .194em 0;content:"↓"}mjx-c.mjx-c39B::before{padding:.716em .694em 0 0;content:"Λ"}mjx-menclose{display:inline-block;text-align:left;position:relative}mjx-menclose>mjx-dstrike{display:inline-block;left:0;top:0;position:absolute;border-top:.067em solid;transform-origin:left top}mjx-menclose>mjx-ustrike{display:inline-block;left:0;bottom:0;position:absolute;border-top:.067em solid;transform-origin:left bottom}mjx-menclose>mjx-hstrike{border-top:.067em solid;position:absolute;left:0;right:0;bottom:50%;transform:translateY(.034em)}mjx-menclose>mjx-vstrike{border-left:.067em solid;position:absolute;top:0;bottom:0;right:50%;transform:translateX(.034em)}mjx-menclose>mjx-rbox{position:absolute;inset:0px;border:.067em solid;border-radius:.267em}mjx-menclose>mjx-cbox{position:absolute;inset:0px;border:.067em solid;border-radius:50%}mjx-menclose>mjx-arrow{position:absolute;left:0;bottom:50%;height:0;width:0}mjx-menclose>mjx-arrow>*{display:block;position:absolute;transform-origin:center bottom;border-left:.268em solid;border-right:0px;box-sizing:border-box}mjx-menclose>mjx-arrow>mjx-aline{left:0;top:-.034em;right:.201em;height:0;border-top:.067em solid;border-left:0}mjx-menclose>mjx-arrow[double]>mjx-aline{left:.201em;height:0}mjx-menclose>mjx-arrow>mjx-rthead{transform:skewX(.464rad);right:0;bottom:-1px;border-bottom:1px solid transparent;border-top:.134em solid transparent}mjx-menclose>mjx-arrow>mjx-rbhead{transform:skewX(-.464rad);transform-origin:center top;right:0;top:-1px;border-top:1px solid transparent;border-bottom:.134em solid transparent}mjx-menclose>mjx-arrow>mjx-lthead{transform:skewX(-.464rad);left:0;bottom:-1px;border-width:.134em .268em 1px 0;border-left-style:initial;border-left-color:initial;border-right-style:solid;border-right-color:initial;border-bottom-style:solid;border-bottom-color:transparent;border-top-style:solid;border-top-color:transparent}mjx-menclose>mjx-arrow>mjx-lbhead{transform:skewX(.464rad);transform-origin:center top;left:0;top:-1px;border-width:1px .268em .134em 0;border-left-style:initial;border-left-color:initial;border-right-style:solid;border-right-color:initial;border-top-style:solid;border-top-color:transparent;border-bottom-style:solid;border-bottom-color:transparent}mjx-menclose>dbox{position:absolute;top:0;bottom:0;left:-.3em;width:.6em;border:.067em solid;border-radius:50%;clip-path:inset(0px 0px 0px 0.3em);box-sizing:border-box}mjx-c.mjx-c1D719.TEX-I::before{padding:.694em .596em .205em 0;content:"ϕ"}mjx-c.mjx-c1D713.TEX-I::before{padding:.694em .651em .205em 0;content:"ψ"}mjx-c.mjx-c2207::before{padding:.683em .833em .033em 0;content:"∇"}mjx-c.mjx-c5B.TEX-S4::before{padding:1.75em .583em 1.249em 0;content:"["}mjx-c.mjx-c5D.TEX-S4::before{padding:1.75em .583em 1.249em 0;content:"]"}mjx-c.mjx-c1D440.TEX-I::before{padding:.683em 1.051em 0 0;content:"M"}mjx-c.mjx-c68::before{padding:.694em .556em 0 0;content:"h"}mjx-c.mjx-c210F::before{padding:.695em .562em .013em 0;content:"ℏ"}mjx-c.mjx-c1D709.TEX-I::before{padding:.704em .438em .205em 0;content:"ξ"}mjx-c.mjx-c1D716.TEX-I::before{padding:.431em .406em .011em 0;content:"ϵ"}mjx-c.mjx-c1D444.TEX-I::before{padding:.704em .791em .194em 0;content:"Q"}mjx-c.mjx-c394::before{padding:.716em .833em 0 0;content:"Δ"}mjx-c.mjx-c6B::before{padding:.694em .528em 0 0;content:"k"}mjx-c.mjx-c4A::before{padding:.683em .514em .022em 0;content:"J"}mjx-c.mjx-c3A8::before{padding:.683em .778em 0 0;content:"Ψ"}mjx-c.mjx-c1D6FC.TEX-I::before{padding:.442em .64em .011em 0;content:"α"}mjx-c.mjx-c3A6::before{padding:.683em .722em 0 0;content:"Φ"}mjx-c.mjx-c1D6FD.TEX-I::before{padding:.705em .566em .194em 0;content:"β"}mjx-c.mjx-c2297::before{padding:.583em .778em .083em 0;content:"⊗"}mjx-c.mjx-c2228::before{padding:.598em .667em .022em 0;content:"∨"}mjx-c.mjx-cAC::before{padding:.356em .667em 0 0;content:"¬"}mjx-c.mjx-c2248::before{padding:.483em .778em 0 0;content:"≈"}mjx-c.mjx-c5B.TEX-S3::before{padding:1.45em .528em .949em 0;content:"["}mjx-c.mjx-c5D.TEX-S3::before{padding:1.45em .528em .949em 0;content:"]"}mjx-c.mjx-c221A.TEX-S3::before{padding:1.45em 1.02em .95em 0;content:"√"}mjx-c.mjx-c1D708.TEX-I::before{padding:.442em .53em 0 0;content:"ν"}mjx-c.mjx-c1D466.TEX-I::before{padding:.442em .49em .205em 0;content:"y"}mjx-c.mjx-c1D445.TEX-I::before{padding:.683em .759em .021em 0;content:"R"}mjx-c.mjx-c1D707.TEX-I::before{padding:.442em .603em .216em 0;content:"μ"}mjx-c.mjx-c1D715::before{padding:.715em .566em .022em 0;content:"∂"}mjx-c.mjx-c1D714.TEX-I::before{padding:.443em .622em .011em 0;content:"ω"}mjx-c.mjx-c3A9::before{padding:.704em .722em 0 0;content:"Ω"}mjx-c.mjx-cAF::before{padding:.59em .5em 0 0;content:"¯"}mjx-c.mjx-c78::before{padding:.431em .528em 0 0;content:"x"}mjx-c.mjx-c28.TEX-S4::before{padding:1.75em .792em 1.249em 0;content:"("}mjx-c.mjx-c29.TEX-S4::before{padding:1.75em .792em 1.249em 0;content:")"}mjx-c.mjx-c1D439.TEX-I::before{padding:.68em .749em 0 0;content:"F"}mjx-c.mjx-c37::before{padding:.676em .5em .022em 0;content:"7"}mjx-c.mjx-c1D43B.TEX-I::before{padding:.683em .888em 0 0;content:"H"}mjx-c.mjx-c1D44D.TEX-I::before{padding:.683em .723em 0 0;content:"Z"}mjx-c.mjx-c221D::before{padding:.442em .778em .011em 0;content:"∝"}mjx-c.mjx-c64::before{padding:.694em .556em .011em 0;content:"d"}mjx-c.mjx-c3C::before{padding:.54em .778em .04em 0;content:"<"}mjx-munder{display:inline-block;text-align:left}mjx-over{text-align:left}mjx-munder:not([limits=false]){display:inline-table}mjx-munder>mjx-row{text-align:left}mjx-under{padding-bottom:.1em}mjx-stretchy-h.mjx-c23DF mjx-beg mjx-c::before{content:"";padding:.32em 0 .2em}mjx-stretchy-h.mjx-c23DF mjx-ext mjx-c::before{content:"";padding:.32em 0 .2em}mjx-stretchy-h.mjx-c23DF mjx-end mjx-c::before{content:"";padding:.32em 0 .2em}mjx-stretchy-h.mjx-c23DF mjx-mid mjx-c::before{content:"";padding:.32em 0 .2em}mjx-stretchy-h.mjx-c23DF>mjx-ext{width:50%}mjx-c.mjx-c35::before{padding:.666em .5em .022em 0;content:"5"}mjx-c.mjx-c62::before{padding:.694em .556em .011em 0;content:"b"}mjx-c.mjx-c1D434.TEX-I::before{padding:.716em .75em 0 0;content:"A"}mjx-c.mjx-c1D44F.TEX-I::before{padding:.694em .429em .011em 0;content:"b"}mjx-c.mjx-c1D435.TEX-I::before{padding:.683em .759em 0 0;content:"B"}mjx-c.mjx-c41.TEX-C::before{padding:.728em .819em .05em 0;content:"A"}mjx-c.mjx-c65::before{padding:.448em .444em .011em 0;content:"e"}mjx-c.mjx-c43::before{padding:.705em .722em .021em 0;content:"C"}mjx-c.mjx-c53::before{padding:.705em .556em .022em 0;content:"S"}mjx-c.mjx-c20::before{padding:0 .25em 0 0;content:" "}mjx-c.mjx-c70::before{padding:.442em .556em .194em 0;content:"p"}mjx-c.mjx-c45::before{padding:.68em .681em 0 0;content:"E"}mjx-c.mjx-c1D40B.TEX-B::before{padding:.686em .692em 0 0;content:"L"}mjx-c.mjx-c36::before{padding:.666em .5em .022em 0;content:"6"}mjx-c.mjx-c1D43F.TEX-I::before{padding:.683em .681em 0 0;content:"L"}mjx-c.mjx-c222B.TEX-S1::before{padding:.805em .61em .306em 0;content:"∫"}mjx-c.mjx-c4C.TEX-C::before{padding:.705em .69em .022em 0;content:"L"}mjx-c.mjx-c393::before{padding:.68em .625em 0 0;content:"Γ"}mjx-c.mjx-c1D453.TEX-I::before{padding:.705em .55em .205em 0;content:"f"}mjx-c.mjx-c50::before{padding:.683em .681em 0 0;content:"P"}mjx-c.mjx-c28.TEX-S1::before{padding:.85em .458em .349em 0;content:"("}mjx-c.mjx-c1D447.TEX-I::before{padding:.677em .704em 0 0;content:"T"}mjx-c.mjx-c29.TEX-S1::before{padding:.85em .458em .349em 0;content:")"}mjx-c.mjx-c2E::before{padding:.12em .278em 0 0;content:"."}mjx-c.mjx-c2020::before{padding:.705em .444em .216em 0;content:"†"}mjx-c.mjx-c27E8::before{padding:.75em .389em .25em 0;content:"⟨"}mjx-c.mjx-c27E8.TEX-S2::before{padding:1.15em .611em .649em 0;content:"⟨"}mjx-c.mjx-c27E9.TEX-S2::before{padding:1.15em .611em .649em 0;content:"⟩"}mjx-c.mjx-c1D70B.TEX-I::before{padding:.431em .57em .011em 0;content:"π"}mjx-c.mjx-c5B.TEX-S2::before{padding:1.15em .472em .649em 0;content:"["}mjx-c.mjx-c5D.TEX-S2::before{padding:1.15em .472em .649em 0;content:"]"}mjx-c.mjx-c2026::before{padding:.12em 1.172em 0 0;content:"…"}mjx-c.mjx-c27E8.TEX-S1::before{padding:.85em .472em .35em 0;content:"⟨"}mjx-c.mjx-c27E9.TEX-S1::before{padding:.85em .472em .35em 0;content:"⟩"}mjx-c.mjx-c222B.TEX-S2::before{padding:1.36em .944em .862em 0;content:"∫"}mjx-c.mjx-c2F::before{padding:.75em .5em .25em 0;content:"/"}mjx-c.mjx-c1D465.TEX-I::before{padding:.442em .572em .011em 0;content:"x"}mjx-c.mjx-c38::before{padding:.666em .5em .022em 0;content:"8"}mjx-c.mjx-c1D449.TEX-I::before{padding:.683em .769em .022em 0;content:"V"}mjx-c.mjx-c1D446.TEX-I::before{padding:.705em .645em .022em 0;content:"S"}mjx-c.mjx-c220F.TEX-S2::before{padding:.95em 1.278em .45em 0;content:"∏"}mjx-c.mjx-c39::before{padding:.666em .5em .022em 0;content:"9"}mjx-c.mjx-c3F::before{padding:.705em .472em 0 0;content:"?"}mjx-mfrac{display:inline-block;text-align:left}mjx-frac{display:inline-block;vertical-align:.17em;padding:0 .22em}mjx-frac[type="d"]{vertical-align:.04em}mjx-frac[delims]{padding:0 .1em}mjx-frac[atop]{padding:0 .12em}mjx-frac[atop][delims]{padding:0}mjx-dtable{display:inline-table;width:100%}mjx-dtable>*{font-size:2000%}mjx-dbox{display:block;font-size:5%}mjx-num{display:block;text-align:center}mjx-den{display:block;text-align:center}mjx-mfrac[bevelled]>mjx-num{display:inline-block}mjx-mfrac[bevelled]>mjx-den{display:inline-block}mjx-den[align=right],mjx-num[align=right]{text-align:right}mjx-den[align=left],mjx-num[align=left]{text-align:left}mjx-nstrut{display:inline-block;height:.054em;width:0;vertical-align:-.054em}mjx-nstrut[type="d"]{height:.217em;vertical-align:-.217em}mjx-dstrut{display:inline-block;height:.505em;width:0}mjx-dstrut[type="d"]{height:.726em}mjx-line{display:block;box-sizing:border-box;min-height:1px;height:.06em;border-top:.06em solid;margin:.06em -.1em;overflow:hidden}mjx-line[type="d"]{margin:.18em -.1em}mjx-c.mjx-c2061::before{padding:0;content:""}mjx-c.mjx-c1D703.TEX-I::before{padding:.705em .469em .01em 0;content:"θ"}mjx-c.mjx-c4D.TEX-C::before{padding:.705em 1.201em .05em 0;content:"M"}mjx-c.mjx-c1D706.TEX-I::before{padding:.694em .583em .012em 0;content:"λ"}mjx-c.mjx-c2217::before{padding:.465em .5em 0 0;content:"∗"}mjx-msubsup{display:inline-block;text-align:left}mjx-script{display:inline-block;padding-right:.05em;padding-left:.033em}mjx-script>mjx-spacer{display:block}mjx-c.mjx-c34::before{padding:.677em .5em 0 0;content:"4"}mjx-mspace{display:inline-block;text-align:left}mjx-c.mjx-c71::before{padding:.442em .528em .194em 0;content:"q"}mjx-c.mjx-c75::before{padding:.442em .556em .011em 0;content:"u"}mjx-stretchy-v.mjx-c28 mjx-beg mjx-c::before{content:"⎛";padding:1.154em .875em .655em 0}mjx-stretchy-v.mjx-c28 mjx-ext mjx-c::before{content:"⎜";width:.875em}mjx-stretchy-v.mjx-c28 mjx-end mjx-c::before{content:"⎝";padding:1.165em .875em .644em 0}mjx-stretchy-v.mjx-c28>mjx-end{margin-top:-1.809em}mjx-stretchy-v.mjx-c28>mjx-ext{border-top-width:1.779em;border-bottom-width:1.779em}mjx-stretchy-v.mjx-c29 mjx-beg mjx-c::before{content:"⎞";padding:1.154em .875em .655em 0}mjx-stretchy-v.mjx-c29 mjx-ext mjx-c::before{content:"⎟";width:.875em}mjx-stretchy-v.mjx-c29 mjx-end mjx-c::before{content:"⎠";padding:1.165em .875em .644em 0}mjx-stretchy-v.mjx-c29>mjx-end{margin-top:-1.809em}mjx-stretchy-v.mjx-c29>mjx-ext{border-top-width:1.779em;border-bottom-width:1.779em}mjx-c.mjx-c28.TEX-S3::before{padding:1.45em .736em .949em 0;content:"("}mjx-c.mjx-c29.TEX-S3::before{padding:1.45em .736em .949em 0;content:")"}mjx-c.mjx-c28.TEX-S2::before{padding:1.15em .597em .649em 0;content:"("}mjx-c.mjx-c29.TEX-S2::before{padding:1.15em .597em .649em 0;content:")"}mjx-c.mjx-c1D467.TEX-I::before{padding:.442em .465em .011em 0;content:"z"}mjx-c.mjx-c33::before{padding:.665em .5em .022em 0;content:"3"}mjx-c.mjx-c1D454.TEX-I::before{padding:.442em .477em .205em 0;content:"g"}mjx-c.mjx-c1D45A.TEX-I::before{padding:.442em .878em .011em 0;content:"m"}mjx-msup{display:inline-block;text-align:left}mjx-c.mjx-c32::before{padding:.666em .5em 0 0;content:"2"}mjx-c.mjx-c1D44B.TEX-I::before{padding:.683em .852em 0 0;content:"X"}mjx-msub{display:inline-block;text-align:left}mjx-c.mjx-c1D45D.TEX-I::before{padding:.442em .503em .194em 0;content:"p"}mjx-c.mjx-c1D436.TEX-I::before{padding:.705em .76em .022em 0;content:"C"}mjx-c.mjx-c67::before{padding:.453em .5em .206em 0;content:"g"}mjx-c.mjx-c6D::before{padding:.442em .833em 0 0;content:"m"}mjx-c.mjx-c76::before{padding:.431em .528em .011em 0;content:"v"}mjx-c.mjx-c1D70E.TEX-I::before{padding:.431em .571em .011em 0;content:"σ"}mjx-c.mjx-c22C5::before{padding:.31em .278em 0 0;content:"⋅"}mjx-c.mjx-c63::before{padding:.448em .444em .011em 0;content:"c"}mjx-c.mjx-c73::before{padding:.448em .394em .011em 0;content:"s"}mjx-c.mjx-c1D456.TEX-I::before{padding:.661em .345em .011em 0;content:"i"}mjx-mover{display:inline-block;text-align:left}mjx-mover:not([limits=false]){padding-top:.1em}mjx-mover:not([limits=false])>*{display:block;text-align:left}mjx-stretchy-v.mjx-c7C mjx-ext mjx-c::before{content:"∣";width:.333em}mjx-c.mjx-c1D463.TEX-I::before{padding:.443em .485em .011em 0;content:"v"}mjx-c.mjx-c1D450.TEX-I::before{padding:.442em .433em .011em 0;content:"c"}mjx-c.mjx-c20D7.TEX-V::before{padding:.714em .5em 0 0;content:"→"}mjx-c.mjx-c1D45B.TEX-I::before{padding:.442em .6em .011em 0;content:"n"}mjx-mrow{display:inline-block;text-align:left}mjx-c.mjx-c221A.TEX-S2::before{padding:1.15em 1.02em .65em 0;content:"√"}mjx-c.mjx-c1D459.TEX-I::before{padding:.694em .298em .011em 0;content:"l"}mjx-msqrt{display:inline-block;text-align:left}mjx-root{display:inline-block;white-space:nowrap}mjx-surd{display:inline-block;vertical-align:top}mjx-sqrt{display:inline-block;padding-top:.07em}mjx-sqrt>mjx-box{border-top:.07em solid}mjx-sqrt.mjx-tall>mjx-box{padding-left:.3em;margin-left:-.3em}mjx-c.mjx-c1D460.TEX-I::before{padding:.442em .469em .01em 0;content:"s"}mjx-c.mjx-c1D45E.TEX-I::before{padding:.442em .46em .194em 0;content:"q"}mjx-c.mjx-c221A.TEX-S1::before{padding:.85em 1.02em .35em 0;content:"√"}mjx-c.mjx-c221A::before{padding:.8em .853em .2em 0;content:"√"}mjx-c.mjx-c49::before{padding:.683em .361em 0 0;content:"I"}mjx-c.mjx-c69::before{padding:.669em .278em 0 0;content:"i"}mjx-c.mjx-c6E::before{padding:.442em .556em 0 0;content:"n"}mjx-c.mjx-c55::before{padding:.683em .75em .022em 0;content:"U"}mjx-c.mjx-c6C::before{padding:.694em .278em 0 0;content:"l"}mjx-c.mjx-c2200::before{padding:.694em .556em .022em 0;content:"∀"}mjx-c.mjx-c226A::before{padding:.568em 1em .067em 0;content:"≪"}mjx-c.mjx-c61::before{padding:.448em .5em .011em 0;content:"a"}mjx-c.mjx-c66::before{padding:.705em .372em 0 0;content:"f"}mjx-c.mjx-cA0::before{padding:0 .25em 0 0;content:" "}mjx-mtable{display:inline-block;text-align:center;vertical-align:.25em;position:relative;box-sizing:border-box;border-spacing:0px;border-collapse:collapse}mjx-mstyle[size="s"] mjx-mtable{vertical-align:.354em}mjx-labels{position:absolute;left:0;top:0}mjx-table{display:inline-block;vertical-align:-.5ex;box-sizing:border-box}mjx-table>mjx-itable{vertical-align:middle;text-align:left;box-sizing:border-box}mjx-labels>mjx-itable{position:absolute;top:0}mjx-mtable[justify=left]{text-align:left}mjx-mtable[justify=right]{text-align:right}mjx-mtable[justify=left][side=left]{padding-right:0!important}mjx-mtable[justify=left][side=right]{padding-left:0!important}mjx-mtable[justify=right][side=left]{padding-right:0!important}mjx-mtable[justify=right][side=right]{padding-left:0!important}mjx-mtable[align]{vertical-align:baseline}mjx-mtable[align=top]>mjx-table{vertical-align:top}mjx-mtable[align=bottom]>mjx-table{vertical-align:bottom}mjx-mtable[side=right] mjx-labels{min-width:100%}mjx-mlabeledtr{display:table-row;text-align:left}mjx-mlabeledtr[rowalign=top]>mjx-mtd{vertical-align:top}mjx-mlabeledtr[rowalign=center]>mjx-mtd{vertical-align:middle}mjx-mlabeledtr[rowalign=bottom]>mjx-mtd{vertical-align:bottom}mjx-mlabeledtr[rowalign=baseline]>mjx-mtd{vertical-align:baseline}mjx-mlabeledtr[rowalign=axis]>mjx-mtd{vertical-align:.25em}mjx-mtr{display:table-row;text-align:left}mjx-mtr[rowalign=top]>mjx-mtd{vertical-align:top}mjx-mtr[rowalign=center]>mjx-mtd{vertical-align:middle}mjx-mtr[rowalign=bottom]>mjx-mtd{vertical-align:bottom}mjx-mtr[rowalign=baseline]>mjx-mtd{vertical-align:baseline}mjx-mtr[rowalign=axis]>mjx-mtd{vertical-align:.25em}mjx-mtd{display:table-cell;text-align:center;padding:.215em .4em}mjx-mtd:first-child{padding-left:0}mjx-mtd:last-child{padding-right:0}mjx-mtable>*>mjx-itable>:first-child>mjx-mtd{padding-top:0}mjx-mtable>*>mjx-itable>:last-child>mjx-mtd{padding-bottom:0}mjx-tstrut{display:inline-block;height:1em;vertical-align:-.25em}mjx-labels[align=left]>mjx-mtr>mjx-mtd{text-align:left}mjx-labels[align=right]>mjx-mtr>mjx-mtd{text-align:right}mjx-mtd[extra]{padding:0}mjx-mtd[rowalign=top]{vertical-align:top}mjx-mtd[rowalign=center]{vertical-align:middle}mjx-mtd[rowalign=bottom]{vertical-align:bottom}mjx-mtd[rowalign=baseline]{vertical-align:baseline}mjx-mtd[rowalign=axis]{vertical-align:.25em}mjx-c.mjx-c24::before{padding:.75em .5em .056em 0;content:"$"}mjx-mtext{display:inline-block;text-align:left}mjx-c.mjx-c5C::before{padding:.75em .5em .25em 0;content:"\\"}mjx-c.mjx-c74::before{padding:.615em .389em .01em 0;content:"t"}mjx-c.mjx-c6F::before{padding:.448em .5em .01em 0;content:"o"}mjx-c.mjx-c72::before{padding:.442em .392em 0 0;content:"r"}mjx-c.mjx-c3E::before{padding:.54em .778em .04em 0;content:">"}mjx-c.mjx-c2192::before{padding:.511em 1em .011em 0;content:"→"}mjx-c.mjx-c7C::before{padding:.75em .278em .249em 0;content:"|"}mjx-c.mjx-c27E9::before{padding:.75em .389em .25em 0;content:"⟩"}mjx-texatom{display:inline-block;text-align:left}mjx-c.mjx-c40::before{padding:.705em .778em .011em 0;content:"@"}mjx-c.mjx-c1D451.TEX-I::before{padding:.694em .52em .01em 0;content:"d"}mjx-c.mjx-c1D458.TEX-I::before{padding:.694em .521em .011em 0;content:"k"}mjx-c.mjx-c1D441.TEX-I::before{padding:.683em .888em 0 0;content:"N"}mjx-c.mjx-c1D438.TEX-I::before{padding:.68em .764em 0 0;content:"E"}mjx-c.mjx-c3D::before{padding:.583em .778em .082em 0;content:"="}mjx-c.mjx-c2212::before{padding:.583em .778em .082em 0;content:"−"}mjx-c.mjx-c1D6FF.TEX-I::before{padding:.717em .444em .01em 0;content:"δ"}mjx-c.mjx-c1D43C.TEX-I::before{padding:.683em .504em 0 0;content:"I"}mjx-c.mjx-c2B::before{padding:.583em .778em .082em 0;content:"+"}mjx-c.mjx-c1D448.TEX-I::before{padding:.683em .767em .022em 0;content:"U"}mjx-c.mjx-c2208::before{padding:.54em .667em .04em 0;content:"∈"}mjx-c.mjx-c5B::before{padding:.75em .278em .25em 0;content:"["}mjx-c.mjx-c30::before{padding:.666em .5em .022em 0;content:"0"}mjx-c.mjx-c2C::before{padding:.121em .278em .194em 0;content:","}mjx-c.mjx-c5D::before{padding:.75em .278em .25em 0;content:"]"}mjx-c.mjx-c210E.TEX-I::before{padding:.694em .576em .011em 0;content:"h"}mjx-c.mjx-c1D45C.TEX-I::before{padding:.441em .485em .011em 0;content:"o"}mjx-c.mjx-c1D70C.TEX-I::before{padding:.442em .517em .216em 0;content:"ρ"}mjx-c.mjx-c1D45F.TEX-I::before{padding:.442em .451em .011em 0;content:"r"}mjx-c.mjx-c1D44E.TEX-I::before{padding:.441em .529em .01em 0;content:"a"}mjx-c.mjx-c1D702.TEX-I::before{padding:.442em .497em .216em 0;content:"η"}mjx-c.mjx-c1D452.TEX-I::before{padding:.442em .466em .011em 0;content:"e"}mjx-c.mjx-c1D461.TEX-I::before{padding:.626em .361em .011em 0;content:"t"}mjx-container[jax=CHTML]{line-height:0}mjx-container [space="1"]{margin-left:.111em}mjx-container [space="2"]{margin-left:.167em}mjx-container [space="3"]{margin-left:.222em}mjx-container [space="4"]{margin-left:.278em}mjx-container [space="5"]{margin-left:.333em}mjx-container [rspace="1"]{margin-right:.111em}mjx-container [rspace="2"]{margin-right:.167em}mjx-container [rspace="3"]{margin-right:.222em}mjx-container [rspace="4"]{margin-right:.278em}mjx-container [rspace="5"]{margin-right:.333em}mjx-container [size="s"]{font-size:70.7%}mjx-container [size=ss]{font-size:50%}mjx-container [size=Tn]{font-size:60%}mjx-container [size=sm]{font-size:85%}mjx-container [size=lg]{font-size:120%}mjx-container [size=Lg]{font-size:144%}mjx-container [size=LG]{font-size:173%}mjx-container [size=hg]{font-size:207%}mjx-container [size=HG]{font-size:249%}mjx-container [width=full]{width:100%}mjx-box{display:inline-block}mjx-block{display:block}mjx-itable{display:inline-table}mjx-row{display:table-row}mjx-row>*{display:table-cell}mjx-mtext{display:inline-block}mjx-mstyle{display:inline-block}mjx-merror{display:inline-block;color:red;background-color:#ff0}mjx-mphantom{visibility:hidden}mjx-assistive-mml{top:0;left:0;clip:rect(1px,1px,1px,1px);user-select:none;position:absolute!important;padding:1px 0 0!important;border:0!important;display:block!important;width:auto!important;overflow:hidden!important}mjx-assistive-mml[display=block]{width:100%!important}mjx-math{display:inline-block;text-align:left;line-height:0;text-indent:0;font-style:normal;font-weight:400;font-size:100%;font-size-adjust:none;letter-spacing:normal;border-collapse:collapse;overflow-wrap:normal;word-spacing:normal;white-space:nowrap;direction:ltr;padding:1px 0}mjx-container[jax=CHTML][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=CHTML][display=true][width=full]{display:flex}mjx-container[jax=CHTML][display=true] mjx-math{padding:0}mjx-container[jax=CHTML][justify=left]{text-align:left}mjx-container[jax=CHTML][justify=right]{text-align:right}mjx-mi{display:inline-block;text-align:left}mjx-c{display:inline-block}mjx-utext{display:inline-block;padding:.75em 0 .2em}mjx-mo{display:inline-block;text-align:left}mjx-stretchy-h{display:inline-table;width:100%}mjx-stretchy-h>*{display:table-cell;width:0}mjx-stretchy-h>*>mjx-c{display:inline-block;transform:scaleX(1)}mjx-stretchy-h>*>mjx-c::before{display:inline-block;width:initial}mjx-stretchy-h>mjx-ext{overflow:clip visible;width:100%}mjx-stretchy-h>mjx-ext>mjx-c::before{transform:scaleX(500)}mjx-stretchy-h>mjx-ext>mjx-c{width:0}mjx-stretchy-h>mjx-beg>mjx-c{margin-right:-.1em}mjx-stretchy-h>mjx-end>mjx-c{margin-left:-.1em}mjx-stretchy-v{display:inline-block}mjx-stretchy-v>*{display:block}mjx-stretchy-v>mjx-beg{height:0}mjx-stretchy-v>mjx-end>mjx-c{display:block}mjx-stretchy-v>*>mjx-c{transform:scaleY(1);transform-origin:left center;overflow:hidden}mjx-stretchy-v>mjx-ext{display:block;height:100%;box-sizing:border-box;border:0 solid transparent;overflow:visible clip}mjx-stretchy-v>mjx-ext>mjx-c::before{width:initial;box-sizing:border-box}mjx-stretchy-v>mjx-ext>mjx-c{transform:scaleY(500) translateY(.075em);overflow:visible}mjx-mark{display:inline-block;height:0}mjx-mn{display:inline-block;text-align:left}mjx-c::before{display:block;width:0}.MJX-TEX{font-family:MJXZERO,MJXTEX}.TEX-B{font-family:MJXZERO,MJXTEX-B}.TEX-I{font-family:MJXZERO,MJXTEX-I}.TEX-MI{font-family:MJXZERO,MJXTEX-MI}.TEX-BI{font-family:MJXZERO,MJXTEX-BI}.TEX-S1{font-family:MJXZERO,MJXTEX-S1}.TEX-S2{font-family:MJXZERO,MJXTEX-S2}.TEX-S3{font-family:MJXZERO,MJXTEX-S3}.TEX-S4{font-family:MJXZERO,MJXTEX-S4}.TEX-A{font-family:MJXZERO,MJXTEX-A}.TEX-C{font-family:MJXZERO,MJXTEX-C}.TEX-CB{font-family:MJXZERO,MJXTEX-CB}.TEX-FR{font-family:MJXZERO,MJXTEX-FR}.TEX-FRB{font-family:MJXZERO,MJXTEX-FRB}.TEX-SS{font-family:MJXZERO,MJXTEX-SS}.TEX-SSB{font-family:MJXZERO,MJXTEX-SSB}.TEX-SSI{font-family:MJXZERO,MJXTEX-SSI}.TEX-SC{font-family:MJXZERO,MJXTEX-SC}.TEX-T{font-family:MJXZERO,MJXTEX-T}.TEX-V{font-family:MJXZERO,MJXTEX-V}.TEX-VB{font-family:MJXZERO,MJXTEX-VB}mjx-stretchy-h mjx-c,mjx-stretchy-v mjx-c{font-family:MJXZERO,MJXTEX-S1,MJXTEX-S4,MJXTEX,MJXTEX-A!important}@font-face{font-family:MJXZERO;src:url("site-lib/fonts/mathjax_zero.woff") format("woff")}@font-face{font-family:MJXTEX;src:url("site-lib/fonts/mathjax_main-regular.woff") format("woff")}@font-face{font-family:MJXTEX-B;src:url("site-lib/fonts/mathjax_main-bold.woff") format("woff")}@font-face{font-family:MJXTEX-I;src:url("site-lib/fonts/mathjax_math-italic.woff") format("woff")}@font-face{font-family:MJXTEX-MI;src:url("site-lib/fonts/mathjax_main-italic.woff") format("woff")}@font-face{font-family:MJXTEX-BI;src:url("site-lib/fonts/mathjax_math-bolditalic.woff") format("woff")}@font-face{font-family:MJXTEX-S1;src:url("site-lib/fonts/mathjax_size1-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S2;src:url("site-lib/fonts/mathjax_size2-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S3;src:url("site-lib/fonts/mathjax_size3-regular.woff") format("woff")}@font-face{font-family:MJXTEX-S4;src:url("site-lib/fonts/mathjax_size4-regular.woff") format("woff")}@font-face{font-family:MJXTEX-A;src:url("site-lib/fonts/mathjax_ams-regular.woff") format("woff")}@font-face{font-family:MJXTEX-C;src:url("site-lib/fonts/mathjax_calligraphic-regular.woff") format("woff")}@font-face{font-family:MJXTEX-CB;src:url("site-lib/fonts/mathjax_calligraphic-bold.woff") format("woff")}@font-face{font-family:MJXTEX-FR;src:url("site-lib/fonts/mathjax_fraktur-regular.woff") format("woff")}@font-face{font-family:MJXTEX-FRB;src:url("site-lib/fonts/mathjax_fraktur-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SS;src:url("site-lib/fonts/mathjax_sansserif-regular.woff") format("woff")}@font-face{font-family:MJXTEX-SSB;src:url("site-lib/fonts/mathjax_sansserif-bold.woff") format("woff")}@font-face{font-family:MJXTEX-SSI;src:url("site-lib/fonts/mathjax_sansserif-italic.woff") format("woff")}@font-face{font-family:MJXTEX-SC;src:url("site-lib/fonts/mathjax_script-regular.woff") format("woff")}@font-face{font-family:MJXTEX-T;src:url("site-lib/fonts/mathjax_typewriter-regular.woff") format("woff")}@font-face{font-family:MJXTEX-V;src:url("site-lib/fonts/mathjax_vector-regular.woff") format("woff")}@font-face{font-family:MJXTEX-VB;src:url("site-lib/fonts/mathjax_vector-bold.woff") format("woff")}mjx-c.mjx-c1D442.TEX-I::before{padding:.704em .763em .022em 0;content:"O"}mjx-c.mjx-c28::before{padding:.75em .389em .25em 0;content:"("}mjx-c.mjx-c31::before{padding:.666em .5em 0 0;content:"1"}mjx-c.mjx-c29::before{padding:.75em .389em .25em 0;content:")"}</style><pre class="frontmatter language-yaml" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">tags</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> scheduling
  <span class="token punctuation">-</span> threads
  <span class="token punctuation">-</span> time
<span class="token key atrule">class</span><span class="token punctuation">:</span> CS 439
<span class="token key atrule">Unit</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2026-02-24</span></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="1.12_Interrupts_and_Preemption_0">1.12 Interrupts and Preemption</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-h1"><h1 data-heading="Overview" dir="auto" class="heading" id="Overview_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Overview</h1></div><div class="el-p"><p dir="auto">Key features from today echoed from the bottom:</p></div><div class="el-p"><span style="display: block; margin-block-start: var(--p-spacing); margin-block-end: var(--p-spacing);"><span alt="^keyInfo" src="#^keyInfo" class="internal-embed markdown-embed inline-embed is-loaded" data-type="block" target="_self"><div class="embed-title markdown-embed-title"></div><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered node-insert-event show-indentation-guide allow-fold-headings allow-fold-lists show-properties"><div class="markdown-preview-sizer markdown-preview-section" style="padding-bottom: 0px; min-height: 269px;"><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4"></path></svg></div><div class="callout-title-inner">Key information</div></div><div class="callout-content">
<p dir="auto">He knows we can get it all working without calling disable interrupts (remember by the way that this only goes to a given core). </p>
<ul class="has-list-bullet">
<li data-line="2" dir="auto"><span class="list-bullet"></span>Strict <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D442 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span> requirement</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code class="code-styler-inline">no_preempt</code> is released from this but only used for people in the middle of context switch</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>Blocking locks are for user code so they're okay for them to use</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>Now everything utilities blocking locks. So we have a requirement to make blocking_locks work if we're not a thread<br>
</li>
</ul>
</div></div></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div><div class="markdown-embed-link" aria-label="Open link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-maximize-2"><path d="M15 3h6v6"></path><path d="m21 3-7 7"></path><path d="m3 21 7-7"></path><path d="M9 21H3v-6"></path></svg></div><p></p></span></span></div><div class="el-h1"><h1 data-heading="Notes" dir="auto" class="heading" id="Notes_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Notes</h1></div><div class="el-p"><p dir="auto">Notes on the file taken on a separate branch to p4 in <code class="code-styler-inline">02242026class</code>.</p></div><div class="el-p"><p dir="auto">Second part of class!</p></div><div class="el-p"><p dir="auto">All the race conditions we can run into!</p></div><div class="el-h2"><h2 data-heading="Race Conditions we can get" dir="auto" class="heading" id="Race_Conditions_we_can_get_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Race Conditions we can get</h2></div><div class="el-p"><p dir="auto">How does preemption work?</p></div><div class="el-p"><p dir="auto">We have our <code class="code-styler-inline">apitHandler</code></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-c code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-c is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">apitHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">	<span class="token comment">// Runs every millisecond</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">	</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">	<span class="token comment">// Acknowledge the interupt</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">	<span class="token function">EOI</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">		</div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">	<span class="token comment">// in theorey we shoudl be able to call yeild!</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">	<span class="token comment">// cause yield has the information about who to run next</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">	<span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">	<span class="token comment">// it *looks* like the current running thread called apitHandler, a forced call but still</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">	<span class="token comment">// but this isn't working in practice</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">14</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Why can't we? Well it's cause there are places where we're not allowed to yield. </p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">We're not a thread yet, <code class="code-styler-inline">fs</code> is 00000 - So if w'ere a real thread then yield</li>
<li data-line="1" dir="auto">The idle-thread should also never yield. There's no point in doing that if the idle thread</li>
<li data-line="2" dir="auto">If you're a normal thread who's in the process of switching to another thread for any reason (waiting for a condition, doesn't have a lock, etc.) it shouldn't yield! We need to let it finish!</li>
</ol></div><div class="el-p"><p dir="auto">We're going to add a flag <code class="code-styler-inline">no_preempt</code>. It's the notion of a flag for a thread to tell the system to not preempt us <em>yet</em>. If we use it undisciplined ways then preemption fails and the world breaks. User programs can't say this, but in the system implementation we <em>can</em> say this.</p></div><div class="el-p"><p dir="auto">This is another way to deal with critical sections! Disabling interupts, spin locks, blocking locks, and now <code class="code-styler-inline">no_preempt</code>. These all go to different kinds of critical sections</p></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">no_preempt</code> is meant to handle sections that are for accessing the threads, like don't let us yield.</p></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4"></path></svg></div><div class="callout-title-inner"> <strong>This also doesn't have the <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D442 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span> requirement!</strong></div></div></div></div><div class="el-p"><p dir="auto">Nothing is prevented from running, so it's to our advantage to turn this on. Interrupts can still come in and queue up, just that one thread which is in the middle of doing the best thing ever which is giving up the CPU so someone else can work. </p></div><div class="el-p"><p dir="auto">Well how do we implement it?<br>
We can be <code class="code-styler-inline">per_core</code>, whoever is running on our core is saying we can't be preempted so don't stop her.<br>
Except that we get some issues with <code class="code-styler-inline">per_core</code> over <code class="code-styler-inline">per_thread</code>. </p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-c code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-c is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">auto</span> p <span class="token operator">=</span> PerCore<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">p<span class="token operator">-&gt;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text"><span class="token comment">// what's the issue?</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token comment">// well by the time we use p, we could have the wrong p with preemption. </span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">But why isn't this applying to <code class="code-styler-inline">per_thread</code></p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-c code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-c is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><br></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text"><span class="token keyword">auto</span> me <span class="token operator">=</span> TCB<span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">me<span class="token operator">-&gt;</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">This is okay because for the thread to be executing we have to have our environment setup safely anyways.<br>
Let's say Thursday we're in Paris, and he joins o Zoom and lectures from there. That works! He's the same dude just in Paris. It's still us, the identity is preserved in <code class="code-styler-inline">per_thread</code>. That's invariant.<br>
That's saved by our <code class="code-styler-inline">fs</code> saving during context_switching.<br>
That way we're immune to core changes cause <code class="code-styler-inline">context_switching</code> saves all our values on switch!</p></div><div class="el-p"><p dir="auto"><code class="code-styler-inline">per_core</code> becomes <em>very very tricky</em> to use over anything else</p></div><div class="el-p"><p dir="auto">Everywhere we ask for the current idle thread on a core, we risk picking up the wrong idle thread. </p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr"><div class="excalidraw-svg-center"><div style="max-width:400px; " class="excalidraw-svg-center excalidraw-embedded-img excalidraw-canvas-immersive" filesource="Supplemental Files/images/1.12 2026-02-24 17.13.59.excalidraw.md" w="400" draggable="false" oncanvas="false"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 667.5585595090232 222.0697804136915" class="excalidraw-svg"><!-- svg-source:excalidraw --><metadata></metadata><defs><style class="style-fonts">
      @font-face { font-family: Excalifont; src: url(data:font/woff2;base64,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); }</style></defs><rect x="0" y="0" width="667.5585595090232" height="222.0697804136915" fill="#ffffff"></rect><g transform="translate(282.7663192898317 18.95119622351055) rotate(0 132.62991333007812 12.5)"><text x="0" y="17.619999999999997" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">PerCore::get()-&gt;idle_thread</text></g><g transform="translate(197.54499187165362 21.634836756721285) rotate(0 12.169998168945312 12.5)"><text x="0" y="17.619999999999997" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="20px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">t0</text></g><g transform="translate(281.1239553917687 61.95599742108254) rotate(270 14.384994506835938 21.875)"><text x="0" y="30.835" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="35px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">...</text></g><g transform="translate(95.24794768561998 72.6425284251932) rotate(0 78.02294158935547 13.75)"><text x="0" y="19.381999999999998" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="22px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">PREEMPTION</text></g><g transform="translate(10 23.710905576351706) rotate(0 32.834983825683594 13.75)"><text x="0" y="19.381999999999998" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="22px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Core 1</text></g><g transform="translate(12.240412849669099 138.49636130029288) rotate(0 35.837982177734375 13.75)"><text x="0" y="19.381999999999998" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="22px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">Core 2</text></g><g transform="translate(184.39108426128917 144.22943859685935) rotate(0 10.779998779296875 13.75)"><text x="0" y="19.381999999999998" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="22px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">t1</text></g><g stroke-linecap="round"><g transform="translate(15.153714255270188 55.04033795219644) rotate(0 272.3192688994221 0.4519349079792292)"><path d="M-0.32 -1.13 C90.51 -1.1, 453.96 0.29, 544.96 0.82 M1.71 0.88 C92.39 1.02, 453.4 2.18, 544 2.02" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(15.306119984130532 119.45373276389208) rotate(0 320.98304608832484 0.4595286153446523)"><path d="M-0.29 -0.67 C106.95 -0.34, 535.07 1.01, 642.25 1.1 M1.76 1.59 C108.96 1.69, 534.64 -0.36, 641.41 -0.44" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(252.0619866286229 11.821685532893554) rotate(0 -0.07536644315813135 99.28353370549299)"><path d="M0.92 -0.42 C0.89 33.11, -1.07 166.89, -1.13 200.25 M-0.06 -1.68 C0.35 31.57, 0.96 164.62, 0.98 198.42" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g stroke-linecap="round"><g transform="translate(95.41469624122465 10.803922993689781) rotate(0 -0.6432645789999469 94.4594097658285)"><path d="M-1.1 -0.8 C-1.24 30.67, -0.66 158.05, -0.57 189.72 M0.53 1.39 C0.15 32.47, -1.46 157.18, -1.81 188.14" stroke="#1e1e1e" stroke-width="2" fill="none"></path></g></g><mask></mask><g transform="translate(302.5259905966169 156.8345206579082) rotate(0 153.284912109375 27.5)"><text x="0" y="19.381999999999998" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="22px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">And now we're fucked cause </text><text x="0" y="46.882" font-family="Excalifont, Xiaolai, sans-serif, Segoe UI Emoji" font-size="22px" fill="#1e1e1e" text-anchor="start" style="white-space: pre;" direction="ltr" dominant-baseline="alphabetic">that's the wrong idlethread</text></g></svg></div></div></th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr">Diagram of the new race condition, we grabbed the wrong <code class="code-styler-inline">idle_thread</code>!</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">Anywhere that's core-dependent, we need to see if it's dangerous. We don't need preemption here so <code class="code-styler-inline">no_preempt</code>, but we can also just disable interrupts. Both solve it</p></div><div class="el-ul"><ul class="has-list-bullet">
<li data-line="0" dir="auto"><span class="list-bullet"></span><em>(credit Daniel)</em>: You could put your idle_threads in a different <code class="code-styler-inline">readyqueue</code>, then pop off as needed</li>
</ul></div><div class="el-h2"><h2 data-heading="Remembering If We Want To Be Interupted" dir="auto" class="heading" id="Remembering_If_We_Want_To_Be_Interupted_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Remembering If We Want To Be Interupted</h2></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-c code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-c is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">apitHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">	<span class="token comment">// interupts disabled in here</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">	</div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">	</div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text">	<span class="token comment">// we want to finish this work quickly since we've diabled interupts</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">7</div><div class="code-styler-line-text">	<span class="token comment">// or switch to someone who can</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">8</div><div class="code-styler-line-text">	<span class="token comment">// someone who has their own stack, we need some other independent entity who has her own stack and can do things</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">9</div><div class="code-styler-line-text">	<span class="token comment">// These are off level interupt handlers</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">10</div><div class="code-styler-line-text">	<span class="token comment">// these then schedule an off_level interupt handler. This then has the freedom to take locks and spin that interupt handlers wanna avoid</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">11</div><div class="code-styler-line-text">	<span class="token comment">// what we then wanna do is *switch stacks*</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">12</div><div class="code-styler-line-text">	</div></div><div class="code-styler-line"><div class="code-styler-line-number">13</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Feel free to use our idle_thread as the off_level interrupt handler!</p></div><div class="el-p"><p dir="auto">The off level handler wants interrupts enabled so the pointer is snatched from it.  Then her daughter gets blocked, and switches back to the <code class="code-styler-inline">apitHandler</code>. The issue has happened though!  Interrupts still need to be disabled so the stack doesn't overflow. We didn't finish the work of her.<br>
Whether interrupts are on or off is part of the state of the thread we switch to, and that needs to be honored. </p></div><div class="el-p"><p dir="auto">Instructions called <code class="code-styler-inline">pushf</code> and <code class="code-styler-inline">popf</code> which pushes and pops something off the stack.<br>
We need to make the value of 200 in the correct place, then the value 200 goes into the flags, and the 1 right in the middle is the exact spot the interrupt flag is supposed to be.</p></div><div class="el-p"><p dir="auto">Drop it into <code class="code-styler-inline">2040</code> in the stack. </p></div><div class="el-p"><p dir="auto">Spin-locks need to store the interrupt state and restore it on the way out. It's not symmetric. The spin-lock disables interrupts on the way in, but we need to restore the last flag on the way back out. We only ever enable interrupts though, if they're supposed to be disabled do nothing</p></div><div class="el-ul"><ul class="contains-task-list has-list-bullet">
<li data-line="0" data-task="0" class="task-list-item is-checked" dir="auto"><span class="list-bullet"></span><input data-line="0" checked="" type="checkbox" class="task-list-item-checkbox">This is implemented already</li>
</ul></div><div class="el-p"><p dir="auto">We need to change context_switch to do this method.</p></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4"></path></svg></div><div class="callout-title-inner">Key information</div></div><div class="callout-content">
<p dir="auto">He knows we can get it all working without calling disable interrupts (remember by the way that this only goes to a given core). </p>
<ul class="has-list-bullet">
<li data-line="2" dir="auto"><span class="list-bullet"></span>Strict <span class="math math-inline is-loaded"><mjx-container class="MathJax" jax="CHTML"><mjx-math class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D442 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math></mjx-container></span> requirement</li>
<li data-line="3" dir="auto"><span class="list-bullet"></span><code class="code-styler-inline">no_preempt</code> is released from this but only used for people in the middle of context switch</li>
<li data-line="4" dir="auto"><span class="list-bullet"></span>Blocking locks are for user code so they're okay for them to use</li>
<li data-line="5" dir="auto"><span class="list-bullet"></span>Now everything utilities blocking locks. So we have a requirement to make blocking_locks work if we're not a thread<br>
</li>
</ul>
</div></div></div><div class="el-p"><p dir="auto">Easiest implementation for sleep, not correct, but just implements sleep</p></div><div class="el-pre has-run-code-button code-styler-pre-parent"><pre class="language-c code-styler-pre" defaultfold="false"><div class="code-styler-header-container-hidden"></div><code data-line="0" class="language-c is-loaded"><div class="code-styler-line"><div class="code-styler-line-number">1</div><div class="code-styler-line-text"><span class="token function">sleep</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">2</div><div class="code-styler-line-text">	when <span class="token operator">=</span> jiffes <span class="token operator">+</span> ms<span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">3</div><div class="code-styler-line-text">	<span class="token keyword">while</span><span class="token punctuation">(</span>jiffies<span class="token operator">&lt;</span>when<span class="token punctuation">)</span><span class="token punctuation">{</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">4</div><div class="code-styler-line-text">		<span class="token function">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">5</div><div class="code-styler-line-text">	<span class="token punctuation">}</span></div></div><div class="code-styler-line"><div class="code-styler-line-number">6</div><div class="code-styler-line-text"><span class="token punctuation">}</span></div></div></code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">It's functionally correct, but this is inefficient. This isn't blocking. Ideally we want to be able to be blocking, don't sit in a loop. Wake me up when the time arrives.<br>
How do we know the time got there though? Well there's the apitHandler which runs every millisecond who can manage who to wakeup. You just need to have whatever data-structure managing this as per_core. Each core has their own timing queue. So no locking needed. Waking up is just to the ready queue</p></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme-toggle-input" id=""><input class="theme-toggle-input" type="checkbox" id="theme-toggle-input"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div class="graph-view-wrapper"><div class="feature-header"><div class="feature-title">Interactive Graph</div></div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<div class="graph-icon graph-global" role="button" aria-label="Global Graph" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><circle cx="18" cy="6" r="3"></circle><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"></path><path d="M12 12v3"></path></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html#1.12_Interrupts_and_Preemption_0" data-path="#1.12_Interrupts_and_Preemption_0"><div class="tree-item-inner heading-link" heading-name="1.12 Interrupts and Preemption">1.12 Interrupts and Preemption</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html#Overview_0" data-path="#Overview_0"><div class="tree-item-inner heading-link" heading-name="Overview">Overview</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html#Notes_0" data-path="#Notes_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Notes">Notes</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html#Race_Conditions_we_can_get_0" data-path="#Race_Conditions_we_can_get_0"><div class="tree-item-inner heading-link" heading-name="Race Conditions we can get">Race Conditions we can get</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="school/cs/cs-439/notes/1.12-interrupts-and-preemption.html#Remembering_If_We_Want_To_Be_Interupted_0" data-path="#Remembering_If_We_Want_To_Be_Interupted_0"><div class="tree-item-inner heading-link" heading-name="Remembering If We Want To Be Interupted">Remembering If We Want To Be Interupted</div></a><div class="tree-item-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>